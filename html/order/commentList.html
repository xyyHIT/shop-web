<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>评价列表</title>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no">
    <script src="/shop/js/rem.js"></script>
    <link href="/shop/css/base.css" rel="stylesheet" type="text/css" />
    <link href="/shop/css/font/iconfont.css" rel="stylesheet" type="text/css" />
    <link href="/shop/css/order.css" rel="stylesheet" type="text/css" />
    <style>
        .list{background: #fff;margin:1rem;overflow: hidden;border-radius:10px;  padding-bottom:1rem;}
        .list .boxs{ overflow:hidden; padding-bottom:.5rem; }
        .list .boxs .boxList {padding:1rem 1rem 0 1rem ; position: relative}
        .list .boxs .boxList .content{height:3rem; line-height:3rem; font-size:1.1rem; color:#333;}
        .list .boxs .boxList .date{ position: absolute; right:1rem; top:.5rem ;font-size:1rem; color:#999;}
        .list .boxs ul{padding:0 .7rem;}
        .list .boxs ul li{float: left; width:33.33%; padding:0 .3rem;}
        .list .boxs ul li img{width:100%;}

        .reply{background:#ededed; margin:0 1rem; cilor:#999; padding:1rem;}
    </style>
</head>
<body>
<div class="container">

    <nav class="nav5">
        <a data_type="0">全部</a><a data_type="1">好<em>(1)</em></a><a data_type="2">一般<em>(11)</em></a><a data_type="3">差<em>(1212)</em></a><a data_type="4">有图<em>(1)</em></a>
    </nav>
    <div class="list">
        <div class='boxs'>
            <div class="boxList">
                    <div><span><a href="javascript:;"><img src=""></a></span><span class="level"></span><span>sdsdsdsd</span></div>
                    <div class="content">该唱片的的质量有点暴躁考点附近路口的房间看到了福....</div>
                    <div class="date">2017-01-23</div>
            </div>
            <ul>
                <li><img src='../../imgs/test/0.jpg' /></li><li><img src='../../imgs/test/0.jpg' /></li><li><img src='../../imgs/test/0.jpg' /></li>
            </ul>

        </div>

        <div class="reply">
            店家回复：福建分行经理看粉红色看警方很快锁定
        </div>

    </div>
</div>
</body>

<script src="/shop/js/jquery-2.1.4.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="/shop/js/public.js"></script>
<script src="/shop/js/order.js"></script>
<script src="/shop/js/fastclick.js"></script>
<script>
    var goodsId = allFun.getRequest("goodsId");//商品id
        evaluation = allFun.getRequest("evaluation");//tab类型
        curr_page = 1;
        finished = true;
    if(!evaluation){
        evaluation = 0;
    }
    $(function () {
        //缓存
        if(sessionStorage.getItem("commentListShopStorage") && allFun.getRequest("history") == -1){
            var commentListShopStorage = JSON.parse(sessionStorage.getItem("commentListShopStorage"));
            evaluation = commentListShopStorage.evaluation;
           //getOrderList(linkType);
            sessionStorage.removeItem("commentListShopStorage");
        }else{
            sessionStorage.removeItem("commentListShopStorage");
            getCommentList(goodsId,evaluation);
        }



        $("nav a").each(function(){
            if($(this).attr("data_type") == evaluation){
                $(this).addClass("on").siblings().removeClass("on");
            }
        });

        //tab切换
        $("nav a").click(function () {
            evaluation = $(this).attr("data_type");
            console.log(evaluation);
            $(this).addClass("on").siblings().removeClass("on");
            $(".list").empty();
            curr_page = 1;
            getCommentList(goodsId,evaluation);
        });
        //点击查看更多
        $(window).on('scroll', function () {
            var dHeight = document.documentElement.offsetHeight;
            var sHeight = document.documentElement.scrollTop || document.body.scrollTop;
            var wHeight = document.documentElement.clientHeight;
            if (finished && dHeight - (sHeight + wHeight) < 200) {
                finished = false;
                if($(".seemore").attr("data_d") != "no"){
                    curr_page++;
                    //getCommentList(linkType);
                }
            }
        })

        //点击跳转到详情
        $("body").on("click",".box li",function(){
            var _t = $(this),obj = {};
            obj.evaluation = evaluation;
            sessionStorage.setItem("commentListShopStorage", JSON.stringify(obj));
           // history.replaceState(null,null,"?linkType="+linkType+"&type="+type+"&history=-1");

           // location.href = "/shop/html/order/orderDetail.html?orderId="+_t.parents(".box").attr("data_order_id")+"&type="+type+"";
        })

        //点击搜索跳转
        $("body").on("click",".header a",function(){
            location.href = "/shop/html/order/orderSearch.html?type="+type+"";
        })

    })
    function getCommentList(goodsId,evaluation){//evaluation类别   （评论类别: 0 => 所有 1 => 差评 2 => 中评 3 => 好评 4 => 有图）

        $.ajax({
            url: host + "/index.php?app=goods&act=ejComments&evaluation="+evaluation+"&goodsId="+goodsId+"&page="+curr_page+"",
            type: "get",
            dataType: "json",
            beforeSend:function(){
                if(curr_page == 1){//第一次
                    allFun.loading();
                }
            },
            success: function(rs) {
                allFun.removeLoading();
                if(rs.code == 0) {
                    $(".seemore").remove();
                    curr_page = rs.data.page.curr_page;
                    finished = true;
                    var obj = "",
                        d = rs.data.comments,
                        item_count = rs.data.page.item_count,//总条数
                        pageper = rs.data.page.pageper;//每页条数
                        console.log(d);
                } else {
                    allFun.alertDiv(rs.msg);
                }
            },
            error: function() {
                allFun.removeLoading();
                allFun.alertDiv("error!")
            }
        })
    }
</script>
</html>