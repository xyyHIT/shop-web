<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>年货节</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="format-detection" content="telephone=no">
		<script src="/shop/js/rem.js"></script>
		<link href="/shop/css/base.css" rel="stylesheet" type="text/css" />
		<link href="/shop/css/index.css" rel="stylesheet" type="text/css" />
		<link href="/shop/css/swiper.min.css" rel="stylesheet" type="text/css" />
		<link href="/shop/css/font/iconfont.css" rel="stylesheet" type="text/css" />
		<style>
			.tNav{ height: auto;}
			.banner a{ display: table-cell; width: 32rem; height: 15rem; vertical-align: middle; text-align: center; overflow: hidden;}
			.banner img{ width: auto; max-width: 100%; height: 100%;}
			.ons{color:#ec4747;}
			.topic a{ display: table-cell; width: 32rem; height: 15rem; vertical-align: middle; text-align: center;}
			.topic img{max-width: 100%; max-height: 15rem;}
			.container{width:100%; height:100%;}
			.swiper-slide {font-size: 1.3rem; background: #fff; display: -webkit-box;  display: -ms-flexbox;  display: -webkit-flex;  display: flex;  -webkit-box-pack: center;  -ms-flex-pack: center;  -webkit-justify-content: center;  justify-content: center;  -webkit-box-align: center;  -ms-flex-align: center;  -webkit-align-items: center;  align-items: center;  }

			.vertical-view{background: #fff; margin-top:.5rem; padding-top:1rem; overflow: hidden;}
			.vertical-view a{font-size:1.4rem; color:#3c3c3c;}
			.vertical-view dl{width:33.33%; text-align: center; float: left;}
			.vertical-view dl dt.icon{ font-size: 4rem;}
		    .vertical-view dl dd{padding:1rem 0;}

            .gather_node .swiper-container{padding-left: 10px;   width: 100%;background: #fff;margin:0 0 10px;}
			.swp_views{padding-left:10px; background: #fff; margin:1rem 0;}
			.swp_list .inner{padding: 10px 0px;}
			.swp_list .inner a{display: table-cell;width: 8rem;height: 8rem;vertical-align: middle;overflow: hidden;}
			.swp_list .inner img{width: 100%;margin-bottom: 4px;max-width: 8rem; max-height: 8rem;}
			.swp_list .inner h4{width: 100%;height: 38px;  line-height: 18px;  color: #333;  font-size: 12px;  margin-bottom: 2px;}
			.swp_list .inner p{color: #ec4747;  font-family: Helvetica;  font-size: 1rem;}
			.swp_list{background: #fff;}
			.swp_list .swiper-slide{padding-right:10px;}
            .header{padding: 1rem 1.5rem;background-color:#fff; margin:4.5rem 0 0.5rem 0;position: relative;z-index: 200;}
            .header #searchInput{font-size:1.1rem;color:#9e9e9e;float:left;height:2.5rem;line-height:2.5rem;width:100%;padding-left:3rem;background:#e7e7e7;border:none;border-radius:5px; }
            #search-button{float:right;border-radius:4px; border:1px solid #5f5f5f;width:6rem;height:2.5rem;display: inline-block;text-align: center;line-height: 2.5rem;font-size: 1.1rem;color:#5f5f5f;}
            .searchBg{position: absolute; top:1.25rem; left:2rem; font-size:1.6rem; color:#6e6e6e;}
            
            header{ position: fixed; top: 0; left: 0; width: 100%; border-bottom: 1px solid #EFEFEF; z-index: 9998;}


		</style>
	</head>
	<body>
	<div class="container">
		<div class="mask"></div>
		<!--//导航-->
		<header>
			<nav class="tNav">
				<div class="swiper-container" id="nav">
					<div class="swiper-wrapper" id="navList">
						<!--<div class="swiper-slide">精选</div>
						<div class="swiper-slide">书画</div>-->
					</div>
				</div>
			</nav>
		</header>
		<!--搜索-->
		<div class="header fix">
			<a href="/shop/html/index/goodsSearch.html">
				<div class="searchBg iconfont icon-sousuo"></div>
				<div id="searchInput">输入搜索的商品名称...</div>
			</a>
		</div>

		<div class="warp">
			<!--轮播banner-->
			<div class="swiper-container banner indexBanner">
				<div class="swiper-wrapper" id="banner">
				</div>
				<div class="swiper-pagination"></div>
			</div>

			<div class="vertical-view">
				<a href="#" id="yijiapaimai">
					<dl>
						<dt class="icon iconfont icon-paimai"></dt>
						<dd>拍卖</dd>
					</dl>
				</a>
				<a href="#" id="cFindex">
					<dl>
						<dt class="icon iconfont icon-zhongchou"></dt>
						<dd>众筹</dd>
					</dl>
				</a>
				<a href="#" id="zixun">
					<dl>
						<dt class="icon iconfont icon-zixun"></dt>
						<dd>资讯</dd>
					</dl>
				</a>
			</div>

			<!--产品展示-->
			<div class="swiper-container swp_views">
				<div class="swiper-wrapper swp_list" id="recommend">

				</div>
			</div>

			<div class="sale_all">
				<!--<div class="gather_tit"><a href="javascript:;"><h3>每日好货</h3></a></div>-->
			</div>

		</div>
	</div>
	</body>
	
	<script src="/shop/js/jquery-2.1.4.min.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script src="/shop/js/swiper.min.js"></script>
	<script src="/shop/js/public.js"></script>
	<script src="/shop/js/fastclick.js"></script>
	<script>
		$(function () {
			//分享
			wx.ready(function(){
				wx.showAllNonBaseMenuItem();
			});
			$(".footer a").eq(0).addClass("on");
            //点击跳到艺加拍卖
            $("body").on("click","#yijiapaimai",function(){
                location.href = hostPm+"/yjpai/platform/scene/scene.html";
            });
            //点击跳到 众筹
            $("body").on("click","#cFindex",function(){
                location.href = hostPm+"/yjpai/platform/crowdFunding/cFindex.html";
            });

            //点击跳到资讯
            $("body").on("click","#zixun",function(){
                location.href = hostPm+"/yjpai/news/list.html";
            });
            //返回到当前位置
            if (sessionStorage.getItem("indexShopStorage") && allFun.getRequest("history") == -1) {
                var Storage = JSON.parse(sessionStorage.getItem("indexShopStorage"));
                $(".container").html(Storage.cont);
                $("body").scrollTop(Storage.scrollTop);
                sessionStorage.removeItem("indexShopStorage");
                swiper();
            } else {
                sessionStorage.removeItem("indexShopStorage");
                gooodsList();
            }
			//一级导航
            $("body").on("click",".tNav #navList>div",function(){
                //获取导航的id
                var nav_id=$(this).attr("nav_id");
                $(this).addClass("rent").siblings().removeClass("rent");
                $(".sale_all").empty();
                if(nav_id==0){
                    $(".vertical-view").show();
                    $("#banner").show();
                    $("#recommend").show();
                    gooodsList();
                }else {
                    $(".vertical-view").hide();
                    $("#banner").hide();
                    $("#recommend").hide();
                    cate(nav_id);
                }
            });
            //精选
			function gooodsList(){
				$.ajax({
					url: host+'/index.php?app=default&act=ejIndex',
					type: "post",
					beforeSend:function(){
						allFun.loading()
					},
					success: function(rs) {
						allFun.removeLoading();
						if(rs.code!=0){
							allFun.alertDiv(rs.msg);
							return false;
						}
						//nav
                        var navData = rs.data.categories;
                        var str='',str2='', nId=0;
                        str+='<div class="swiper-slide rent" nav_id='+nId+'>精选</div>';
                        for(var i=0; i<navData.length; i++){
                            str+='<div class="swiper-slide " nav_id='+navData[i].id+'>'+navData[i].cateName+'</div>'
                        }
                        $("#navList").html(str);

						//banner轮播
						var bannerData = rs.data.cycleImages;
						var bannerList = "";
						for(var z = 0;z<bannerData.length;z++){
							bannerList+='<div class="swiper-slide"><a href="'+bannerData[z].image_link+'"><img src="'+bannerData[z].image_url+'/platform"/></a></div>'
						}
						$("#banner").html(bannerList);

						//推荐产品和产品列表
						var goodsData = rs.data.recommend;
						var goodsList = '';recommend='';
						for(i = 0;i<goodsData.length;i++){
							var res='', res2='',listData=goodsData[i].items,recom_name=goodsData[i].recom_name;

							if(recom_name=="精品推荐"){
                                if(listData){
                                    if(listData.length>0 ) {
                                        for (j = 0; j < listData.length; j++) {
                                            recommend += '<div class="swiper-slide">'
                                                + '<div class="inner">'
                                                + '<a href="javascript:;" goodsId="' + listData[j].goods_id + '">'
                                                + '<img src="' + listData[j].default_image + '/square" alt="">'
                                                + '<h4 class="over over2">' + listData[j].goods_name + '</h4>'
                                                + '<p>¥<span>' + listData[j].price + '</span></p>'
                                                + '</a>'
                                                + '</div>'
                                                + '</div>'
                                        }
                                    }
								}
							}else {
							    if(listData){
                                     if(listData.length>0 ){ res2 += '<div class="topic"><a href="javascript:;"  goodsId="'+listData[0].goods_id+'"><img src="'+listData[0].default_image+'/platform" alt=""></a> </div>'}
                                   }
                                if(listData){
                                    if(listData.length>0 ) {
                                        for (j = 1; j < listData.length; j++) {
                                            res += '<div class="swiper-slide">'
                                                + '<div class="inner">'
                                                + '<a href="javascript:;" goodsId="' + listData[j].goods_id + '">'
                                                + '<img src="' + listData[j].default_image + '/square" alt="">'
                                                + '<h4 class="over over2">' + listData[j].goods_name + '</h4>'
                                                + '<p>¥<span>' + listData[j].price + '</span></p>'
                                                + '</a>'
                                                + '</div>'
                                                + '</div>'
                                        }
                                    }
								}
								goodsList+='<div class="gather_node">'
										+'<div class="gather_tit">'
										+'<a href="javascript:;">'
										+'<h3>'+goodsData[i].recom_name+'</h3>'
										+'</a>'
										+'</div>'
                                        +res2
										+'<div class="swiper-container swp_views">'
										+'<div class="swiper-wrapper swp_list">'
											+res
										+'</div>'
										+'</div>'
										+'</div>';
							}
						}
						$(".sale_all").append(goodsList);
						$("#recommend").html(recommend);
                        swiper();
					},
                    error: function() {
                        allFun.removeLoading();
                        allFun.alertDiv("error!")
                    }
				});
			}

            //点击导航其他选项的列表
			function cate(nav_id) {
                $.ajax({
                    url: host + '/index.php?app=catinfo&cate_id='+nav_id+'',
                    type: "post",
					data:{"cate_id":nav_id},
                    beforeSend: function () {
                        allFun.loading()
                    },
                    success: function (rs) {
                        allFun.removeLoading();
                        if (rs.code != 0) {
                            allFun.alertDiv(rs.msg);
                            return false;
                        }
                        var cate=rs.data,cateList='';
                        for(var z=0; z<cate.length;z++){
                            var obj = '', obj2 = '', catinfo = cate[z].goodslist;
                            if(cate){
                                if(cate.length>0 ) {
                                    obj += '<div class="topic"><a href="javascript:;" goodsId="' + catinfo[0].goods_id + '"><img src="' + catinfo[0].default_image + '/platform" alt=""></a> </div>';
                                }
                                if(cate){
                                    if(catinfo.length>0 ) {
                                        for (var w = 1; w < catinfo.length; w++) {
                                            obj2 += '<div class="swiper-slide">'
                                                + '<div class="inner">'
                                                + '<a href="javascript:;" goodsId="' + catinfo[w].goods_id + '">'
                                                + '<img src="' + catinfo[w].default_image + '/square"  alt="">'
                                                + '<h4 class="over over2">' + catinfo[w].goods_name + '</h4>'
                                                + '<p>¥<span>' + catinfo[w].price + '</span></p>' + '</a>'
                                                + ' </div>'
                                                + ' </div>'
                                        }
                                    }
                                }
                            cateList+='<div class="gather_node">'
                                +'<div class="gather_tit">'
                                +'<a href="javascript:;"> <h3>'+cate[z].cate_name+'</h3></a>'
                                +'</div>'
								+obj
								+'<div class="swiper-container swp_views">'
                                +'<div class="swiper-wrapper swp_list">'
                                +obj2
                                +' </div>'
                                +' </div>'
                                +' </div>'
                            }
						}
						$(".sale_all").html(cateList);
                        swiper();
                    },
                    error: function() {
                        allFun.removeLoading();
                        allFun.alertDiv("error!")
                    }
                });
            }

            //点击列表跳转
            $("body").on("click", ".topic a,.inner a", function () {
                var _t = $(this);
                delFn(_t,"/shop/html/index/goodsDetails.html?goodsId=");
            });
            function delFn(t,url){
                var obj = {};
                obj.cont = $(".container").html();
                obj.scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                sessionStorage.setItem("indexShopStorage", JSON.stringify(obj));
                history.replaceState(null, null, "?history=-1");
                location.href = url+t.attr("goodsId");
                //location.href = "/shop/html/index/goodsDetails.html?goodsId="+_t.attr("goodsId");
            }

        });
        function swiper() {
            //导航
            var swiper = new Swiper('#nav', {
                slidesPerView: 5.5,
                paginationClickable: true,
                spaceBetween: 0,
                freeMode: true
            });
            //banner
            var swiper = new Swiper('.indexBanner', {
                pagination: '.swiper-pagination',
                autoplay: 3500,
                autoplayDisableOnInteraction: false,
                loop: true
            });

            //多图轮播
            var swiper = new Swiper('.swp_views', {
                slidesPerView: 3.5,
                paginationClickable: true,
                spaceBetween: 0
            });
        }
	</script>
</html>