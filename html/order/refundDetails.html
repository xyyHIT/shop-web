<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>退款管理</title>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no">
    <script src="/shop/js/rem.js"></script>
    <link href="/shop/css/base.css" rel="stylesheet" type="text/css" />
    <link href="/shop/css/font/iconfont.css" rel="stylesheet" type="text/css" />
    <script src="/shop/css/font/iconfont.js"></script>

    <style>
        body{background: #fff;}
        .refundDetails .refundTitle{width:100%;overflow: hidden;}
        .refundTitle{width:100%; padding:1rem; }

        .refundTitle .pro dl ,.refundTitle .pro2 dl{ position: relative;float: left; text-align: center; width: 33%;}
        .refundTitle .pro2 dl {  width: 20%;}
        .refundTitle .pro dl .line,.refundTitle .pro2 dl .line{border-top:1px solid #d8d8d8; position: absolute; top:.8rem; left: 6.2rem; width:100%;z-index: -1;}
        .refundTitle .pro2 dl .line{left: 3rem; }
        .refundTitle .pro dl.left .line,.refundTitle .pro2 dl.left .line{ left: 3.5rem; width:100%;z-index: -1;}
        .refundTitle .pro2 dl.left .line{ left: 3.5rem;}
        .refundTitle dl.left{text-align: left;}
        .refundTitle dl.right{text-align: right;}
        .refundTitle dl.left dt {text-align: left; margin-left:.8rem;}
        .refundTitle dl.right dt {text-align: right;margin-right:.8rem;}
        .refundTitle dl dd{font-size:1rem;color: #d8d8d8;}
        .refundTitle dl span{width:2.5rem; text-align: center; background:#fff;display: inline-block;}
        .refundTitle dl em{display:inline-block;width:1.6rem; height: 1.6rem; line-height: 1.6rem; text-align: center; color:#fff; background: #d8d8d8; border-radius: 50%;}
        .refundTitle dl.on em{ background:#ec4747; border-radius: 50%;}
        .refundTitle dl.on dd{color:#ec4747;}
        .refundTitle dl dt{margin-bottom:.5rem;}

        .refundContent{background:#FBB7B7; padding: 1rem;}
        .refundContent .title{padding:.5rem 0 1.5rem; border-bottom: 1px solid  #fff;}
        .refundContent .title span{color:#fff; font-size: 1.2rem;}
        .refundContent .title span em{width:1.5rem; height:1.5rem;display: inline-block; margin-right: .2rem;}

        .content{color:#fff;font-size: 1.1rem; padding:.5rem 0rem 0;}
        .content span{color:#333;padding:0 .5rem;}
        .content div{padding-bottom:.5rem;}
        .call span{display:inline-block;height:3rem; line-height:3rem; width:48%; text-align: center; background:#fff; border-radius: 5px;}
        .call span a{color:#333;}
        .call .agree{margin-right:1rem;}
        .buyerCall{padding-top:1rem;}

        .main{background:#f8f8f8; padding:1rem; margin-top:1rem;}
        .main .record { padding-bottom: 1.5rem;}
        .records{ border-bottom: 1px solid #d8d8d8;}
        .main .record span{font-size:1.2rem; color:#333; font-weight: bold;}
        .main .record em{font-style: normal;}
        .main .record .seat{color:#999;font-size:1rem;font-weight: normal;}
        .list .record span{font-size:1.1rem;font-weight: normal;}
        .list{    border-top: 1px solid #d8d8d8;}
        .list .record{padding:1rem 0; border-bottom: none;}
        .list ul li{padding:.5rem 0 .5rem 1rem;font-size:1rem;}
        .consent .record{padding:1rem 0;}
        .consent .record span{font-weight: normal;}
        .address{margin:.5rem 0 0 0.5rem ;color:#999;}

        .buyerCall span{display:inline-block;height:3rem; line-height:3rem; width:100%; text-align: center; background:#fff; border-radius: 5px;}

        .divTwoInfo .editFont{ position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 9991;}
        .divTwoInfo .editFont div.cc{ position: absolute;left: 50%; top: 50%; width: 92%; height: 30rem; text-align: center; background: #fff; border-radius: 5px; overflow: hidden; -webkit-transform: translate(-50%,-50%); z-index: 9993;}
        .divTwoInfo .editFont h2{ position: relative; height: 5rem; line-height: 5rem; color:#333; font-size:1.1rem; background: #FAF9FB;}
        .divTwoInfo .editFont h2 i{ position: absolute; right: 0; width: 4rem; font-size: 1.6rem; color: #979797; text-align: center;}
        .divTwoInfo .editFont textarea{ width: 95%; height: 17rem; padding: .8rem 1rem; font-size: 1.2rem; line-height: 1.8rem; border:1px solid #EFEFEF; border-radius:5px;}
        .divTwoInfo .edit a{ display: inline-block; width: 42%; height: 4rem; margin-top: 1.3rem; line-height: 4rem; font-size: 1.5rem; color: #fff; letter-spacing: 2px; text-align: center; border-radius: 5px; background: #EC4747;}
        .divTwoInfo .editFont_a{margin-left:6%;}
    </style>
</head>
<body>
<div class="container divTwoInfo">
  <div class="refundDetails">
       <nav class="refundTitle">
           <!--退钱-->

           <!--退钱退货-->
          <!-- <div class="pro2">
               <dl class="left on" >
                   <div class="line"></div>
                   <dt><span><em>1</em></span></dt>
                   <dd>申请退款</dd>
               </dl>
               <dl>
                   <div class="line"></div>
                   <dt><span><em>2</em></span></dt>
                   <dd>卖家处理</dd>
               </dl>
               <dl>
                   <div class="line"></div>
                   <dt><span><em>3</em></span></dt>
                   <dd>交易完成</dd>
               </dl>
               <dl>
                   <div class="line"></div>
                   <dt><span><em>4</em></span></dt>
                   <dd>申请退款</dd>
               </dl>
               <dl class="right">
                   <dt><span><em>5</em></span></dt>
                   <dd>卖家处理</dd>
               </dl>
           </div>-->
       </nav>
  </div>
  <div class="tent"></div>

    <div class="main">
        <div class="record records">
            <span>协商记录</span><span class="right seat">退款单号：<em></em></span>
        </div>
      <!--  <div class="consent consents">
            <div class="record">
                <span>*卖家已退款</span><span class="right seat">2017-02-17 1:35:35</span>
                <div class="address">退货地址：封口令警方联手开发建设降幅可达浪费18号楼</div>
            </div>
        </div>-->
        <div class="consent consent2">
        </div>
    </div>
</div>
</body>
<script src="/shop/js/jquery-2.1.4.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="/shop/js/public.js"></script>
<script src="/shop/js/order.js"></script>
<script src="/shop/js/fastclick.js"></script>
<script>
    $(function () {
        var refund_id=allFun.getRequest("refund_id"); type = allFun.getRequest("type");//0买家 1卖家
        var uu = "";
        if(type == 1) {//卖家
            uu = "/index.php?app=refund&act=seller_view&t="+Date.now();
        }else{//买家
            uu = "/index.php?app=refund&act=buyer_view&t="+Date.now();
        }
        $.ajax({
            url: host + uu + "&refund_id=" + refund_id,
            type: "get",
            beforeSend: function () {},
            success: function (rs) {
                if(rs.code == 0){
                    var d = rs.data,mark=d.log;step=d.step;obj = "";res='';dType=d.type;step=d.step;
                    if(dType==20){//3步退款
                        $('.refundTitle').html('<div class="pro"><dl class="left"><div class="line"></div><dt><span><em>1</em></span></dt><dd>申请退款</dd></dl><dl><div class="line"></div> <dt><span><em>2</em></span></dt> <dd>卖家处理</dd> </dl> <dl class="right"> <dt><span><em>3</em></span></dt> <dd class="end">交易完成</dd></dl> </div>')
                    }else {// 5步退款
                        $('.refundTitle').html('<div class="pro pro2"> <dl class="left" > <div class="line"></div> <dt><span><em>1</em></span></dt> <dd>申请退款</dd> </dl> <dl> <div class="line"></div> <dt><span><em>2</em></span></dt> <dd>卖家处理</dd> </dl> <dl> <div class="line"></div> <dt><span><em>3</em></span></dt> <dd>买家退货</dd> </dl> <dl> <div class="line"></div> <dt><span><em>4</em></span></dt> <dd>卖家退款</dd> </dl> <dl class="right"> <dt><span><em>5</em></span></dt> <dd class="end">交易完成</dd> </dl> </div>')
                    }
                    if(1==step){
                        $(".refundTitle .pro").find("dl:nth-child(1)").addClass("on");
                    }else if(2==step){
                        $(".refundTitle .pro").find("dl:nth-child(1)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(2)").addClass("on");
                    }else if(3==step){
                        $(".refundTitle .pro").find("dl:nth-child(1)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(2)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(3)").addClass("on");
                    }
                    else if(4==step){
                        $(".refundTitle .pro").find("dl:nth-child(1)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(2)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(3)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(4)").addClass("on");
                    }
                    else if(5==step){
                        $(".refundTitle .pro").find("dl:nth-child(1)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(2)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(3)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(4)").addClass("on");
                        $(".refundTitle .pro").find("dl:nth-child(5)").addClass("on");
                    }
                    obj+=d.button;
                    $(".tent").html(obj);
                    $(".tent").attr("data_refund_id",d.id);
                    $(".tent").attr("data_rec_id",d.rec_id);
                    $(".tent").attr("data_order_id",d.order_id);
                    $(".records .seat em").html(d.refund_sn);
                    $(".tent").attr("data_streamid",d.streamid);
                    for(var i=0; i<mark.length;i++){
                    res+='<div class="record"> <span>'+mark[i].remark+'</span><span class="right seat">'+mark[i].log_time+'</span></div>'
                        res+='<div class="list">'+mark[i].content+'</div>';
                       var status=mark[i].refund_status;
                       if(dType==20){
                           if(status==0){
                               $(".refundTitle .pro").find("dl dd.end").html("交易关闭");
                               $(".refundTitle .pro").find("dl:nth-child(3)").addClass("on");
                           }
                       }else {
                           if(status==0){
                               $(".refundTitle .pro").find("dl dd.end").html("交易关闭");
                               $(".refundTitle .pro").find("dl:nth-child(5)").addClass("on");
                           }
                           if(status==3){
                               $(".refundTitle .pro").find("dl dd.end").html("交易关闭");
                               $(".refundTitle .pro").find("dl:nth-child(2)").addClass("on");
                               $(".refundTitle .pro").find("dl:nth-child(3)").addClass("on");
                               $(".refundTitle .pro").find("dl:nth-child(5)").addClass("on");
                           }
                       }
                    }
                    $(".consent").append(res);
                    $('.consent .list:last').css("border","none")
                }else{
                    allFun.alertDiv(rs.msg);
                }
            },
            error: function() {
                allFun.removeLoading();
                allFun.alertDiv("error!")
            }
        });
    })
</script>
</html>