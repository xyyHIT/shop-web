<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>商品详情</title>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no">
    <script src="/shop/js/rem.js"></script>
    <link href="/shop/css/base.css" rel="stylesheet" type="text/css" />
    <link href="/shop/css/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="/shop/css/font/iconfont.css" rel="stylesheet" type="text/css" />
    <style>
        body{background: #f9f9f9; height:100%;}
        .swiper-container {  width: 100%;  max-height: 640px;  }
        .pro-info {padding:1rem 1.5rem; border-top: 1px solid #ddd; overflow: hidden;position: relative;background: #fff;}
        .pro-info .name { font-size: 1.3rem; color: #3c3c3c;  line-height: 2rem; }
        .pro-info .price { font-size: 1.5rem; color: #ec4747; margin:0.3rem 0;  }
        .pro-info .kinds span{color:#aaa; font-size:1.2rem; margin-right:1rem; }
        .pro-info .like{position: absolute; right:1rem; bottom:1rem;color:#878787; font-size:1rem; }
        .pro-info .like .heart{  margin-bottom:.3rem;  text-align: center; font-size: 2.4rem;color: #ec4747;}
        .pro-info .like .grey{color: #9e9e9e;}
        .ways{height:4rem; line-height: 4rem; background: #fcfcfc; padding:0 1rem;}
        .ways .freight{font-size: 1.2rem; color: #aaa;}
        .ways .sales{font-size: 1.2rem; color: #808080;}
        .ways span{display: inline-block; margin: 0rem .5rem 0 0; color: #ec4747;font-size: 1.8rem;}

        .faxian { position: relative; margin:.5rem 0;height: 7rem; padding: 1.4rem 1rem; font-size: 1.3rem; color: #5F5F5F;  background: #fff;}
        .faxian dt img{  width: 4rem; height: 4rem; border-radius: 100%; margin-right:1.5rem;}
        .faxian h3{font-size: 1.3rem; color: #3c3c3c;    width: 12rem;}
        .faxian h3 span img{display: inline-block; margin-top:.2rem; float: left; margin-right:.5rem; background-size:1.5rem 1.5rem; height:1.5rem; width: 1.5rem; }
        .faxian dd p{margin-top:.2rem;  }
        .faxian dd p span{font-size: 1.1rem; margin-right:1rem;color: #878787;}
        .faxian em{position: absolute; right:1rem; top:2.4rem; display: inline-block; width:5rem; text-align: center;border:1px solid #878787;  border-radius:5px; height:2.4rem; line-height: 2.4rem; font-size: 1.1rem;}
        .faxian em i{width:100%; height:100%; display:inline-block;}
        .faxian .noLine{border:none !important; font-size:1.1rem; color:#aaa; top:1.4rem;}

        .trade{width: 100%; line-height:4rem; background: #fff;}
        .trade span{color:#5f5f5f ;padding-left: 1rem;font-size: 1.3rem;}

        .trade_contents{ overflow: hidden;}
        .trade_contents ol{ display: none; background: #fff; padding:1rem;margin-bottom: .5rem}
        .trade_contents ol.current{ display: block;}
        .goodsHot .goodsTitle{background:#fff;width: 100%; padding-left:1rem; margin-bottom:.5rem; line-height:4rem;height: 4rem; font-size: 1.3rem; color: #5f5f5f;}
        .pre-info{margin:.5rem;    overflow: hidden;}
        .pre-list {list-style: none;  margin: 0; margin-left: 1.5%;  margin-bottom: -10px;overflow: hidden;  }
        .pre-list-2 li {width: 50%; float: left; overflow: hidden;  }
        .pre-item {margin: 0 4% 4% 0; background: #fff;overflow:hidden; position: relative;  }
        .pre-item a {display: block;overflow: hidden;  }
        .pre-img {width: 100%;}
        .pre-price {font-size:1.3rem;color: #ec4747;position: relative;}
        .pre-subtitle {margin-bottom: 5px;font-size:1.1rem;color: #535353;overflow: hidden;  }
        .payment{font-size: 1.1rem; color: #aaa;}

        .attMian{width:45%;}
        .footer{display: none;}
        .detailFooter{padding: .4rem 0 .3rem 0;position: fixed; width: 100%;  bottom: 0;  left: 0;  border-top: 1px solid #e5e5e5;  background: rgba(250,250,250,.95);  z-index: 999;}
        .detailFooter i{ position: relative;display: block; width: 2.5rem; height: 2.5rem; margin: 0 auto; margin-bottom: .35rem; font-size: 2rem; line-height: 2.5rem; background-size: 100%;}
        .detailFooter a{width:18%;}
        .detailFooter a.end{position:absolute; width:28%; right:0;line-height: 4.8rem; top:0;display: inline-block; background: #ec4747; color:#fff; text-align: center;}

        .footerInits a{ display: inline-block; width: 18%; height: 100%; font-size: 1.25rem; line-height: 1.25rem; color: #5F5F5F; text-align: center;}
        .footerInits a.on{ color: #EC4747;}
        .footerInits a.on i{ color: #EC4747;}

        .r-red{background:#ec4747; width:1.5rem; height: 1.5rem; text-align: center; line-height: 1.5rem; color:#fff;position: absolute; top:0rem; font-size:1rem; right:-0.3rem; display:inline-block;border-radius: 2.5rem;}
        .bags{position:relative;}
        #rradeMain .main{margin: 0 auto; width: 100%;  font-size: 1.1rem; color: #535353;line-height: 1.6rem;}
        #rradeMain img{ text-align: center; vertical-align: middle; margin: .5rem 0; width: 100%;}
        #f-footer2,f-footer{display: none;}
        #f-footer2 a{width:25%;}
        .swiper-slide{text-align: center}
    </style>
</head>
<body>
<div class="container">
    <!--轮播banner-->
    <div class="swiper-container banner" id="goodsBanner">
        <div class="swiper-wrapper" id="bannerList">

        </div>
        <div class="swiper-pagination"></div>
    </div>
    <div class="pro-info">
        <p class="name over over2"></p>
        <p class="price">￥<span></span></p>
        <p class="kinds"><span><em class="person"></em>人付款</span><span><em class="assess"></em>好评</span></p>
        <div class="like">
            <div class="liks"></div>
            <p><em class="num likeCount" id="likeCount"></em>人喜欢</p>
        </div>
    </div>

    <div class="ways">
        <div class="left sales"><span class="left iconfont icon-7tianwuliyoutuihuo"></span>七天无理由退货</div><div class="right freight">运费：<em></em>元</div>
    </div>
    <div class="attention">
        <dl class='faxian'>
                <dt class="left"><a href="javascript:;"><img src='' /></a></dt>
                <dd  class="left">
                    <h3><span class="level"></span><p class="over over1 name"></p></h3>
                    <p class=""><span>商品<i class="p_num"></i></span><span>关注<i class="g_num"></i></span></p>
                </dd>
                <div class="more"></div>

        </dl>
    </div>
<!--图文详情和评价-->
    <div class="trade">
        <span class="current"><em class="alert"></em>图文详情</span><!--<span id="buyer">商品评价</span>-->
    </div>
    <div class="trade_contents">
        <ol class="current" id="rradeMain">
        </ol>
    </div>

    <div class="goodsHot">
        <div class="goodsTitle">热门推荐</div>

        <ul class="pre-list pre-list-2">
        </ul>
    </div>

    <div class="detailFooter footerInits" id="f-footer">
    </div>

    <div class="detailFooter footerInits" id="f-footer2">
    </div>
</div>
</body>

<script src="/shop/js/jquery-2.1.4.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="/shop/js/swiper.min.js"></script>

<script src="/shop/js/verifyPhone.js"></script>
<script src="/shop/js/fastclick.js"></script>
<script>

    $(function () {
        //用户信息
            $.ajax({
                url: hostPm+"/yjpai/platform/user/getUser",
                type: "get",
                dataType: "json",
                beforeSend: function(){
                    allFun.loading();
                },
                success: function(rs) {
                    allFun.removeLoading();
                    if(rs.resCode==1){
                        var userData = rs.data;
                        //console.log(userData,userData.mobile);
                        $(".cart").attr("data_m",userData.mobile);
                    }
                }
            });

        var lotId = allFun.getRequest("goodsId");//商品id
        goodsList(lotId);
        function goodsList(lotId){
            $.ajax({
                url: host+'/index.php?app=goods&act=index&id='+lotId+'',
                type: "post",
                data:{"id":lotId},
                beforeSend:function(){
                    allFun.loading();
                },
                success: function(rs) {
                    allFun.removeLoading();
                    if(rs.code!=0){
                        allFun.alertDiv(rs.msg);
                        return false;
                    }
                    var goodsData=rs.data.goods,storeData=rs.data.store,bannerData=goodsData.images;
                    //详情页banner
                    banner='';
                    for(var j=0; j<bannerData.length; j++){
                        banner+='<div class="swiper-slide"><a href="javascript:;"><img  data_id="'+bannerData[j].file_id+'" data_initSrc="'+bannerData[j].image_url+'" src="'+bannerData[j].thumbnail+'/banner" alt=""></a></div>';
                    }
                    $("#bannerList").html(banner);
                    //查看大图
                    $("body").on("click",".swiper-slide img",function(){
                        var imgList=[], targetSrc=$(this).attr("data_initSrc");
                        $(this).parents(".swiper-slide").find("img").each(function(){
                            imgList.push($(this).attr("data_initSrc"))
                        });
                        wx.ready(function(){
                            wx.previewImage({
                                current: targetSrc, // 当前显示图片的http链接
                                urls: imgList // 需要预览的图片http链接列表
                            });
                        })
                    });

                    //banner轮播
                    var swiper = new Swiper('#goodsBanner', {
                        pagination: '.swiper-pagination',
                        autoplay: 3500,
                        autoplayDisableOnInteraction : false,
                        loop: true
                    });

                    $(".pro-info .name").html(goodsData.goods_name);
                    $(".pro-info .name").attr("spec_id",goodsData.spec_id);
                    $(".pro-info .price span").html(goodsData.price);
                    $(".pro-info .kinds .person").html(goodsData.sales);
                    status=goodsData.collectsign;
                    $(".liks").html('<p class="heart iconfont icon-xihuan" item_id="'+goodsData.goods_id+'" status="'+status+'"></p>');

                    $(".pro-info .kinds .assess").html(goodsData.good_comment);
                    $(".ways .freight em").html(goodsData.ship_price);
                    $(".like p .num").html(goodsData.collects);
                    //点击喜欢和不喜欢
                    $(".liks p").click(function (){
                        var t=$(this);
                        var num=parseInt($("#likeCount").html());
                        item_id=t.attr("item_id");
                        if(t.hasClass("grey")){
                            $("#likeCount").html(num-1);
                            attention("goods","drop",t);
                        }else{
                            $("#likeCount").html(num+1);
                            attention("goods","add",t);
                        }
                    });
                    //导航进入小店
                    $(".detailFooter .store").attr("href",'/shop/html/my/sellerStore.html?storeId='+goodsData.store_id+'');
                    //店铺关注
                    $(".faxian dt img").attr("src",storeData.logo);
                    $(".faxian dt a").attr("href",'/shop/html/my/sellerStore.html?storeId='+goodsData.store_id+'');
                    $(".faxian dd .name").html(storeData.name);
                    $(".faxian dd .p_num").html(storeData.goods_count);
                    $(".faxian dd .g_num").html(storeData.collect_count);
                    var status=storeData.collectsign;
                    if (status == 0) {
                        $(".faxian .more").html('<em class="gz"><i item_id="' + goodsData.store_id + '" status="' + status + '">+关注</i></em>');
                    }
                    else if (status == 1) {
                        $(".faxian .more").html('<em class="gz"><i item_id="' + goodsData.store_id + '" status="' + status + '" >已关注</i></em>');
                    } else {
                        $('.faxian em').remove();//是当前的用户没有关注按钮 status=2当前用户
                    }
                    //添加关注
                    $(".gz i").click(function () {
                        var t=$(this);
                        item_id=t.attr("item_id");
                        if(t.hasClass("on")){
                            attention("store","drop",t);
                        }else{
                            attention("store","add",t);
                        }
                    });
                    //是当前用户就没有导航就没有加入购物袋
                    if (status == 2) {
                        $("#f-footer").remove();
                        $("#f-footer2").show();
                        $("#f-footer2").html(' <a href="/shop/html/index/index.html?from=wechat"><i class="iconfont icon-nianhuojie"></i>年货节</a><a href="tel:13456787787"><i class="iconfont icon-kefu1"></i>客服</a><a class="store" href="javascript:;"><i class="iconfont icon-quxiaodian"></i>进入小店</a><a class="bags" href="/shop/html/cart/cart.html"><i class="iconfont icon-gouwudai "></i>购物袋</a>')
                    } else {
                        $("#f-footer").show();
                        $("#f-footer2").remove();
                        $("#f-footer").html('<a href="/shop/html/index/index.html?from=wechat"><i class="iconfont icon-nianhuojie"></i>年货节</a><a href="tel:13456787787"><i class="iconfont icon-kefu1"></i>客服</a><a class="store" href="javascript:;"><i class="iconfont icon-quxiaodian"></i>进入小店</a><a class="bags" href="/shop/html/cart/cart.html"><i class="iconfont icon-gouwudai "></i>购物袋</a><a href="javascript:;" class="end cart">放入购物袋</a>')

                    }
                    //获取购物车的数量
                    $.ajax({
                        url: host + '/index.php?app=cart&act=ejCount',
                        type: "get",
                        success: function (rs) {
                            if (rs.code == 0) {
                                if(rs.data.count > 0){
                                    $(".detailFooter .icon-gouwudai").html('<em class="r-red">'+rs.data.count+'</em>');
                                }
                            }
                        }
                    });

                    //图文详情
                    $(".faxian h3 .level").html('<img src="/shop/imgs/level/saler'+storeData.sgrade+'.png">');
                    var desc=JSON.parse(goodsData.detail_desc).records;
                    str='';
                     for(var i=0; i<desc.length; i++){
                         str+='<div class="main">'+desc[i].v+'</div>'
                     }
                    $("#rradeMain").html(str);


                    //热门推荐
                    var mend='', commend=goodsData.commend_goods;
                    $.each(commend,function (j,v) {
                             mend+='<li><div class="pre-item">'
                                +'<a href="/shop/html/index/goodsDetails.html?goodsId='+commend[j].goods_id+'" goodsId="'+commend[j].goods_id+'"><img class="pre-img" src="'+commend[j].default_image+'/square" alt=""> </a>'
                                +'<div class="pre-info">'
                                +'<p class="pre-subtitle over over1" >'+commend[j].goods_name+'</p>'
                                +'<p class="pre-price"><span class="left">¥<em>'+commend[j].price+'</em></span><span class="right payment"><em>'+commend[j].sales+'</em>人付款</span></p>'
                                +' </div>'
                                +'</div></li>'
                    });
                    $(".pre-list").html(mend);
                },
                error: function() {
                    allFun.removeLoading();
                    allFun.alertDiv("error!")
                }
            });
        }
        //关注和喜欢
        //关注
        function attention(type,status,t) {// type=store 商品 type=goods  //status: add-关注 drop-取消关注
            $.ajax({
                url: host + '/index.php?app=my_favorite&act='+status+'&type='+type+'&item_id='+item_id+'',
                type: "get",
                beforeSend: function () {
                },
                success: function (rs) {
                    if (rs.code != 0) {
                        allFun.alertDiv(rs.msg);
                        return false;
                    }
                    if(type=="store"){
                        if(status == 1){//取消关注
                            t.removeClass("on").html("+关注");
                        }else{
                            t.addClass("on").html("已关注");
                        }
                    }else if(type=="goods"){
                        if(status == 1) {
                            t.removeClass("grey");
                        }
                        else{
                            t.addClass("grey");
                        }
                    }

                },
                error: function() {
                    allFun.removeLoading();
                    allFun.alertDiv("error!")
                }
            });
        }
        //加入购物车
        $("body").on("click",".cart", function() {
            var tel=$('.cart').attr("data_m");
            if(tel==null){
            	phoneVerify.start();
            }else{
            	var quantity=1;
	            var spec_id=$('.pro-info .name').attr("spec_id");
	            cart(spec_id,quantity);
            }
        });
        function cart(spec_id,quantity) {
            $.ajax({
                url: host + '/index.php?app=cart&act=ejAdd&spec_id='+spec_id+'&quantity='+quantity+'',
                type: "get",
                beforeSend: function () {
                	allFun.loading();
                },
                success: function (rs) {
                	allFun.removeLoading();
                    if (rs.code != 0) {
                        allFun.alertDiv(rs.msg);
                        return false;
                    }
                    
                    if($(".r-red").length > 0){
                    	$(".r-red").html(quantity+1);
                    }else{
                    	$(".detailFooter .icon-gouwudai").html('<em class="r-red">'+quantity+'</em>');
                    }
                },
                error: function() {
                    allFun.removeLoading();
                    allFun.alertDiv("error!")
                }
            });
        }
    })

</script>
<script src="/shop/js/public.js"></script>
</html>