<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>卖家店铺</title>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no">
    <script src="/shop/js/rem.js"></script>
    <link href="/shop/css/base.css" rel="stylesheet" type="text/css" />
    <link href="/shop/css/font/iconfont.css" rel="stylesheet" type="text/css" />
    <style>
        .faxian { position: relative; height: 8rem; padding: 1.4rem 1rem; font-size: 1.3rem; color: #5F5F5F;  background: #faf9fb;}
        .faxian dt img{  width: 5rem; height: 5rem; border-radius: 100%; margin-right:1.5rem;}
        .faxian h3{font-size: 1.4rem; color: #3c3c3c;margin-top:.4rem;}
        .faxian dd p.more{margin-top:.8rem;}
        .faxian dd p span{font-size: 1rem; color: #878787; margin-right:1rem;}
        .faxian em{position: absolute; right:1rem; top:2.8rem; display: inline-block; width:5rem; text-align: center;border:1px solid #878787;  border-radius:5px; height:2.4rem; line-height: 2.4rem; font-size: 1.1rem;}
        .faxian .noLine{border:none !important; font-size:1.1rem; color:#aaa; top:1.4rem;}

        .trade .on{color: #ec4747;}
        .trade{width: 100%; line-height:3.5rem; margin-bottom: .5rem; background: #fff;}
        .trade span{width:33.33%; position: relative; text-align: center; font-size: 1.2rem; display: inline-block; color: #3c3c3c;;}
        /*.trade span.current{color:#ec4747; border-bottom:2px solid #ec4747 }*/
        .trade span.on,.trade span.on .arrows,.trade span.down, .trade span.down .arrows {color: #ec4747;  }
        .trade .on .arrows{color: #ec4747;transform:rotate(90deg);  -ms-transform:rotate(90deg); 	/* IE 9 */  -moz-transform:rotate(90deg); 	/* Firefox */  -webkit-transform:rotate(90deg); /* Safari 和 Chrome */  -o-transform:rotate(90deg); 	/* Opera */  }
        .trade span .arrows{font-size:1.4rem; color:#3c3c3c;     position: absolute;  margin-right: 1rem;  right: 1rem;  font-size: 1.4rem;  transform:rotate(90deg);  -ms-transform:rotate(-90deg); 	/* IE 9 */  -moz-transform:rotate(-90deg); 	/* Firefox */  -webkit-transform:rotate(-90deg); /* Safari 和 Chrome */  -o-transform:rotate(-90deg); 	/* Opera */}
        .select span.down .arrows{color: #ec4747;transform:rotate(-90deg);  -ms-transform:rotate(-90deg); 	/* IE 9 */  -moz-transform:rotate(-90deg); 	/* Firefox */  -webkit-transform:rotate(-90deg); /* Safari 和 Chrome */  -o-transform:rotate(-90deg); 	/* Opera */  position: absolute; right:1.6rem; top:0rem; font-size: 1.4rem}
        .trade_contents{ overflow: hidden;}
        .trade_contents ol{ display: none; background: #faf9fb;}
        .trade_contents ol.current{ display: block;}

        .pre-info{margin:.5rem;    overflow: hidden;}
        .pre-list {  list-style: none;  margin: 0; margin-left: 1.5%;  margin-bottom: -10px;overflow: hidden;  }
        .pre-list-2 li {width: 50%; float: left; overflow: hidden;  }
        .pre-item {margin: 0 4% 4% 0; background: #fff;overflow:hidden; position: relative;  }
        .pre-item a {display: block;overflow: hidden;  }
        .pre-img {width: 100%;}
        .pre-price {font-size:1.3rem;color: #ec4747;position: relative;}
        .pre-subtitle {margin-bottom: 5px;font-size:1.1rem;color: #535353;overflow: hidden;  }
        .payment{font-size: 1.1rem; color: #aaa;}
        .tel{position: fixed; left:1.5rem; bottom:5rem;  width:5rem; height:5rem; z-index: 9999}
        .tel a{font-size: 4.5rem; color: #ec4747; }
    </style>
</head>
<body>
<div class="container">
    <div class="tel"><a href="tel:13456787787" class="iconfont icon-bodadianhua"></a></div>
        <div class="seller">
            <!--<dl class='faxian'>
                <dt class="left"><img src='../../imgs/test/scene.jpg' /></dt>
                <dd  class="left">
                    <h3><p class="over over1">淡淡的的地方</p></h3>
                    <p class="more"><span>123粉丝</span><span>12%好评</span></p>
                </dd>
                <em>+关注</em>
            </dl>-->
        </div>

    <div class="trade">
        <span class="on" data-type="0">默认</span><span data-type="sales">销量</span><span data-type="price"><i class="arrows iconfont icon-zhankai-copy"></i>价格</span>
    </div>
    <div class="trade_contents">
        <ol class="current">
            <ul class="pre-list pre-list-2">
               <!-- <li>
                    <div class="pre-item">
                        <a href=""><img class="pre-img" src="http://prod.image.yit.com/5/8/5826caa49c05f.jpg-h5square1" alt=""></a>
                        <div class="pre-info">
                            <p class="pre-subtitle over over1" >静音，高效，无耗材，赠送车载净化器，2色可选</p>
                            <p class="pre-price"><span class="left">¥2680</span><span class="right payment">700人付款</span></p>
                        </div>
                    </div>
                </li>-->
            </ul>
        </ol>
    </div>
</div>
</body>

<script src="/shop/js/jquery-2.1.4.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="/shop/js/public.js"></script>
<script src="/shop/js/fastclick.js"></script>
<script>
    $(function () {
        var order=0;
        var curr_page=1,item_count='';
        var store_id = allFun.getRequest("storeId");//店铺id

        //用户信息
        $.ajax({
            url: hostPm+"/yjpai/platform/user/getUser",
            type: "get",
            dataType: "json",
            beforeSend: function(){
                allFun.loading();
            },
            success: function(rs) {
                allFun.removeLoading();
                if(rs.resCode==1){
                    var userData = rs.data;
                    //console.log(userData,userData.mobile);
                    if(userData.mobile==null){
                        $(".tel").hide();
                    }else {
                        $(".tel").html('<a href="tel:'+userData.mobile+'" class="iconfont icon-bodadianhua"></a>');
                    }

                }
            }
        });


        storeList(store_id);
        function storeList(store_id) {
            $.ajax({
                url: host + '/index.php?app=store&act=ejBaseInfo&store_id='+store_id+'',
                type: "get",
                beforeSend: function () {
                },
                success: function (rs) {
                    if (rs.code != 0) {
                        allFun.alertDiv(rs.msg);
                        return false;
                    }
                    var d = rs.data,obj = '';
                    console.log(d);
                    obj += '<dl class="faxian">'
                        +'<dt class="left"><img src="'+d.portrait+'" /></dt>'
                        +'<dd  class="left">'
                        +'<h3><p class="over over1">'+d.user_name+'</p></h3>'
                        +'<p class="more"><span>'+d.followers+'个粉丝</span></p>'
                        +'</dd>';
                        if( d.is_follow == 0){//未关注
                            obj += "<em item_id="+store_id+">+关注</em>";
                        }else{
                            obj += "<em item_id="+store_id+">已关注</em>";
                        }
                        +'</dl>' ;
                    $(".seller").html(obj);
                    //添加关注
                    $(".faxian em").click(function () {
                        var t=$(this);
                        item_id=t.attr("item_id");
                        console.log(item_id);
                        if(t.hasClass("on")){
                            attention("store","drop",t);
                        }else{
                            attention("store","add",t);
                        }
                    });
                },
                error: function() {
                    allFun.removeLoading();
                    allFun.alertDiv("error!")
                }
            });
        }
        //切换
        $("body").on("click",".trade span",function () {
            var index = $(".trade span").index(this);
            var order = $(this).attr("data-type");
            console.log(index,order);
            if($(this).hasClass("on")){
                if(index==2){
                    $(".trade span").removeClass("on");
                    $(this).addClass("down");
                    console.log(order);
                    order="asc";
                }
            }else{
                $(".seemore").remove();
                $(".pre-list").empty();
                $(".trade span").removeClass("on").removeClass("down");
                $(this).addClass("on");
                if(index==1){
                    console.log(order);
                    order="desc";
                }
                if(index==2){
                    console.log(order);
                    order="desc";
                }
            }
            goodsList(order,store_id);

        });
        //点击查看更多
        $(window).on('scroll', function () {
            var dHeight = document.documentElement.offsetHeight;
            var sHeight = document.documentElement.scrollTop || document.body.scrollTop;
            var wHeight = document.documentElement.clientHeight;
            if (finished && dHeight - (sHeight + wHeight) < 200) {
                finished = false;
                if($(".seemore").attr("data_d") != "no"){
                    curr_page++;
                    goodsList(order,store_id);
                }
            }
        });
        // 搜索商品列表
        goodsList(order,store_id);
        function  goodsList(order,store_id){
            $.ajax({
                url: host + '/index.php?app=search&act=ejGoods&order='+order+'&store_id='+store_id+'&page='+curr_page+'',
                type: "get",
                beforeSend: function () {
                    if(curr_page == 1){//第一次
                        allFun.loading();
                    }
                },
                success: function (rs) {
                    allFun.removeLoading();
                    if (rs.code != 0) {
                        allFun.alertDiv(rs.msg);
                        return false;
                    }
                    $(".seemore").remove();
                    // console.log(rs.data.page);
                    curr_page = rs.data.page.curr_page;
                    finished = true;
                    item_count = rs.data.page.item_count;//总条数
                    pageper = rs.data.page.pageper;//每页条数

                    var goodsList=rs.data.goods;
                    console.log(rs.data);
                    var mend='';
                    if(item_count == 0){//无数据(第一次进来)
                        mend += allFun.noDataImg();
                    }else {
                        $.each(goodsList, function (j, v) {
                            mend += '<li><div class="pre-item">'
                                + '<a href="/shop/html/index/goodsDetails.html?goodsId=' + goodsList[j].goods_id + '" goodsId="' + goodsList[j].goods_id + '"><img class="pre-img" src="' + goodsList[j].default_image + '" alt=""> </a>'
                                + '<div class="pre-info">'
                                + '<p class="pre-subtitle over over1" >' + goodsList[j].goods_name + '</p>'
                                + '<p class="pre-price"><span class="left">¥<em>' + goodsList[j].price + '</em></span><span class="right payment">' + goodsList[j].sales + '人付款</span></p>'
                                + ' </div>'
                                + '</div></li>'
                        });

                        if (curr_page < Math.ceil(item_count / pageper)) {//有数据
                            mend += "<div class='seemore'><div class='com-loading'><div></div></div>拼命加载中</div>";
                        } else {//没有更多数据
                            mend += "<div class='seemore' data_d='no'>没有更多数据</div>";
                        }
                    }
                    $(".pre-list").html(mend)
                }
            });
        }

        //关注
        function attention(type,status,t) {// type=store 商品 type=goods  //status: add-关注 drop-取消关注
            $.ajax({
                url: host + '/index.php?app=my_favorite&act='+status+'&type='+type+'&item_id='+item_id+'',
                type: "get",
                beforeSend: function () {
                },
                success: function (rs) {
                    if (rs.code != 0) {
                        allFun.alertDiv(rs.msg);
                        return false;
                    }
                    if(type=="store"){
                        if(status == 1){//取消关注
                            t.removeClass("on").html("+关注");
                        }else{
                            t.addClass("on").html("已关注");
                        }
                    }else if(type=="goods"){
                        if(status == 1) {
                            t.removeClass("grey");
                        }
                        else{
                            t.addClass("grey");
                        }
                    }

                },
                error: function() {
                    allFun.removeLoading();
                    allFun.alertDiv("error!")
                }
            });
        }


    });
</script>
</html>